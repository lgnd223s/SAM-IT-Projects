import sensor, image, time
from machine import Pin
import time

# Setup
sensor.reset()
sensor.set_pixformat(sensor.RGB565)
sensor.set_framesize(sensor.QVGA)
sensor.skip_frames(time=2000)
clock = time.clock()

# Pin assignments
solenoid = Pin("D2", Pin.OUT)
red_led = Pin("LED_R", Pin.OUT)
green_led = Pin("LED_G", Pin.OUT)

# Initial state: Locked (red on)
solenoid.low()
red_led.high()
green_led.low()

while True:
    clock.tick()
    img = sensor.snapshot()

    # Look for any QR code
    codes = img.find_qrcodes()
    if codes:
        # Unlock
        solenoid.high()
        red_led.low()
        green_led.high()
        time.sleep_ms(100)  # 100ms pulse
        solenoid.low()

        # Re-lock indication
        red_led.high()
        green_led.low()

        # Optional: pause to prevent re-triggering too quickly
        time.sleep(2)
